# Week 4.1 - Multi-course + Course/Lesson Routing

## Реализованные изменения

### 1. Обновлен `content/loaders.ts`
- Добавлена поддержка множественных курсов через registry pattern
- Новые функции:
  - `getCourseById(courseId: string)` - загрузка курса по ID
  - `getAllCourses()` - получение всех доступных курсов
  - `getAvailableCourseIds()` - список ID всех курсов
  - `courseExists(courseId: string)` - проверка существования курса
- Тип `CourseLoader` для типизации загрузчиков курсов
- Registry `courseLoaders` для хранения загрузчиков (легко расширяется)

### 2. Обновлен `content/index.ts`
- Экспортированы новые функции из loaders
- Экспортирован тип `CourseLoader`

### 3. Создана страница `/courses` (`app/courses/page.tsx`)
- Список всех доступных курсов
- Состояния: loading, error, empty, ready
- Карточки курсов с информацией (название, описание, количество уроков)
- Кнопка "View Course" для перехода к деталям курса
- Использует существующие компоненты Card и Button

### 4. Создана страница `/courses/[courseId]` (`app/courses/[courseId]/page.tsx`)
- Детали курса с описанием
- Список всех уроков курса
- Для каждого урока: номер, название, описание, количество шагов
- Кнопка "Start Lesson" для каждого урока
- Навигация назад к списку курсов
- Состояния: loading, error, empty, ready

### 5. Создана страница `/courses/[courseId]/lessons/[lessonId]` (`app/courses/[courseId]/lessons/[lessonId]/page.tsx`)
- Использует существующий компонент `LessonPlayer`
- Загружает курс и урок по ID из URL параметров
- Поддержка навигации к следующему уроку в курсе
- Навигация назад к курсу
- Состояния: loading, error, empty, ready
- Интеграция с существующей логикой прогресса

### 6. Добавлены тесты `content/loaders.test.ts`
- Тесты для всех новых функций loaders
- Проверка загрузки курсов
- Проверка обработки ошибок (несуществующий курс)
- Все тесты проходят (9 тестов)

## Структура маршрутов

```
/courses                          → Список всех курсов
/courses/[courseId]               → Детали курса + список уроков
/courses/[courseId]/lessons/[lessonId]  → Урок с Lesson Player
```

## Data Flow

1. **Список курсов**: `getAllCourses()` → валидация каждого курса → отображение
2. **Детали курса**: `getCourseById(courseId)` → валидация → отображение уроков
3. **Урок**: `getCourseById(courseId)` → поиск урока по ID → передача в `LessonPlayer`

## Обработка ошибок

Все страницы используют единый паттерн обработки ошибок:
- **Loading state**: показывается спиннер
- **Error state**: показывается сообщение об ошибке с кнопкой Retry
- **Empty state**: показывается сообщение о пустом состоянии
- **Ready state**: отображается контент

Все ошибки валидации обрабатываются через `loadCourseFromJson()` и показываются пользователю в понятном виде.

## Расширяемость

Для добавления нового курса:
1. Создать JSON файл в `content/`
2. Импортировать JSON в `content/loaders.ts`
3. Добавить загрузчик в `courseLoaders` registry:
   ```typescript
   'new-course-id': () => validateCourse(newCourseJson),
   ```

## Тестирование

- ✅ Все существующие тесты проходят (33 теста)
- ✅ Добавлены тесты для новых функций loaders (9 тестов)
- ✅ TypeScript проверка проходит (кроме существующих ошибок в других файлах)

## Совместимость

- Старая страница `/lesson-player` продолжает работать (использует `getDemoCourse()`)
- Все существующие компоненты переиспользованы
- Нет breaking changes в API

## Использованные компоненты

- `Card` - для карточек курсов и уроков
- `Button` - для действий и навигации
- `LessonPlayer` - переиспользован без изменений

## Примечания

- Все страницы являются client components (`'use client'`)
- Используется Next.js App Router с динамическими сегментами
- Runtime валидация применяется к каждому загруженному курсу
- KISS принцип соблюден - минимальные изменения, максимальная переиспользуемость

